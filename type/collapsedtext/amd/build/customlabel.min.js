define(['jquery','core/log','core/config'],function($,log,cfg){customboxcollapsed={init:function(){$('.custombox-collapsedtext-open-all').bind('click',this.openall);$('.custombox-collapsedtext-close-all').bind('click',this.closeall);$('.custombox-collapsedtext-toggle').bind('click',this.togglestate);$('.custombox-collapsedtext-caption').bind('click',this.togglestateproxy);log.debug('AMD customlabel collapsedtext initialized.')},openall:function(){var that=$(this);var id=that.attr('id').replace('custombox-collapsedtext-open-all-','');var collapsehandleclass='.custombox-collapsedtext-toggle-'+id;var collapseclass='.custombox-collapsedtext-panel-'+id
$(collapseclass).removeClass('collapsed');$(collapsehandleclass+' img').each(function(){var src=$(this).attr('src');$(this).attr('src',src.replace('closed','open'))});var url=cfg.wwwroot+'/mod/customlabel/type/collapsedtext/ajax/service.php';url+='?what=complete';url+='&cmid='+id;$.get(url)},closeall:function(e){var that=$(this);var id=that.attr('id').replace('custombox-collapsedtext-close-all-','');var collapsehandleclass='.custombox-collapsedtext-toggle-'+id;var collapseclass='.custombox-collapsedtext-panel-'+id
$(collapseclass).addClass('collapsed');$(collapsehandleclass+' img').each(function(){var src=$(this).attr('src');$(this).attr('src',src.replace('open','closed'))})},togglestate:function(e){var that=$(this);var toggle=that.hasClass('is-toggle');var fullid=that.attr('id').replace('custombox-collapsedtext-toggle-','');var parts=fullid.split('-');var cmid=parts.shift();var itemid=parts.shift();var collapsehandleid='#custombox-collapsedtext-toggle-'+fullid;var collapseid='#custombox-collapsedtext-panel-'+fullid;var collapsehandleclass='.custombox-collapsedtext-toggle-'+cmid;var collapseclass='.custombox-collapsedtext-panel-'+cmid;if(toggle){if($(collapseid).hasClass('collapsed')){$(collapseid).removeClass('collapsed');var src=$(collapsehandleid+' img').attr('src');$(collapsehandleid+' img').attr('src',src.replace('closed','open'));customboxcollapsed.sendcompletion(cmid,itemid)}else{$(collapseid).addClass('collapsed');var src=$(collapsehandleid+' img').attr('src');$(collapsehandleid+' img').attr('src',src.replace('open','closed'))}}else{$(collapseclass).addClass('collapsed');$(collapseid).removeClass('collapsed');customboxcollapsed.sendcompletion(cmid,itemid);$(collapsehandleclass+' img').each(function(){var src=$(this).attr('src');$(this).attr('src',src.replace('open','closed'))});var src=$(collapsehandleid+' img').attr('src');$(collapsehandleid+' img').attr('src',src.replace('closed','open'))}
e.preventDefault()},togglestateproxy:function(){var that=$(this);var toggleid=that.attr('id').replace('custombox-collapsedtext-caption-','custombox-collapsedtext-toggle-');$('#'+toggleid).trigger('click')},sendcompletion:function(cmid,item){var url=cfg.wwwroot+'/mod/customlabel/type/collapsedtext/ajax/service.php';url+='?what=open';url+='&cmid='+cmid;url+='&item='+item;$.get(url)}};return customboxcollapsed})