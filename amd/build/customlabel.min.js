define("mod_customlabel/customlabel",["jquery","core/config","core/str","core/log"],(function($,cfg,str,log){var customlabel={strs:[],context:[],init:function(params){customlabel.context=params;str.get_strings([{key:"changetypeadvice",component:"customlabel"}]).done((function(s){customlabel.strs=s})),$(".customctl").bind("click",this.togglecustom),$(".customctl-string").bind("click",this.togglecustomstring),$(".customlabel-constraint").bind("click",this.constraint_colorize),$(".mform").on("change",'select[data-constrained = "1"]',this.applyconstraints),$('select[data-constrained = "1"]').prop("disabled",null),$("#id_labelclass").bind("change",this.typechangesubmit),$("#id_level0").trigger("change"),$("#id_level1").trigger("change"),$("#id_level2").trigger("change"),log.debug("AMD Customlabels initialized")},togglecustom:function(){var that=$(this),customthumbid=that.attr("id").replace("customctl-","custom-thumb-"),customid=that.attr("id").replace("customctl-","custom-");$("#"+customid).hasClass("hidden")?($("#"+customid).removeClass("hidden"),$("#"+customthumbid).removeClass("hidden"),that.attr("src",cfg.wwwroot+"/mod/customlabel/pix/plus.gif")):($("#"+customid).addClass("hidden"),$("#"+customthumbid).addClass("hidden"),that.attr("src",cfg.wwwroot+"/mod/customlabel/pix/minus.gif"))},togglecustomstring:function(){var that=$(this),customid=that.attr("id").replace("customctl-","custom-"),parts=that.attr("data-labels").split(",");$("#"+customid).hasClass("hidden")?($("#"+customid).removeClass("hidden"),that.html(parts[1])):($("#"+customid).addClass("hidden"),that.html(parts[2]))},constraint_colorize:function(){1==$(this).val()?this.addclass("green"):this.addclass("red")},applyconstraints:function(){var that=$(this),targets=that.attr("data-constraints"),labeltype=that.attr("data-label-type"),cmid=that.attr("data-cmid");log.debug("Applying constraints on "+that.attr("id"));var i=0;if(""!==targets){var targetsarr=targets.split(","),selectedopts=[];$("#"+that.attr("id")+" option").each((function(){$(this).prop("selected")&&selectedopts.push($(this).val())}));var optionstring=selectedopts.join(","),selectedtargetopts=[],targetvalues=[],targetelms=[],extractvalues=function(){selectedtargetopts[i].push($(this).val()),targetvalues[targetsarr[target]].push($(this).val())};for(var target in targetsarr){targetvalues[targetsarr[target]]=[];var targetname="level"+targetsarr[target];selectedtargetopts[i]=targetname,targetelms.push($("#id_"+targetname).first()),i++,selectedtargetopts[i]=[],$("#id_"+targetname+" option:selected").each(extractvalues),i++}$.each(targetelms,(function(index,value){value.prop("disabled",!0)}));var formvaluestring=encodeURIComponent(JSON.stringify(selectedtargetopts)),url=cfg.wwwroot+"/mod/customlabel/ajax/applyconstraints.php?";url+="selector="+that.attr("name"),url+="&targets="+targets,url+="&type="+labeltype,url+="&cmid="+cmid,url+="&constraints="+optionstring,url+="&selection="+formvaluestring,$.get(url,"",(function(data){var selectors=data,targetsarr=targets.split(",");for(var target in targetsarr)if(selectors[targetsarr[target]]){var str='<input type="hidden" name="level'+targetsarr[target];str+='" value="_qf__force_multiselect_submission">',str+=selectors[targetsarr[target]],log.debug("Rewriting select #fitem_id_level"+targetsarr[target]+" .felement"),$("#fitem_id_level"+targetsarr[target]+" .felement").html(str)}for(var levelid in targetvalues){var selectvalue=targetvalues[levelid][0];selectvalue>0&&$("#id_level"+levelid+" option[value="+selectvalue+"]").attr("selected",!0)}$('select[data-constrained = "1"]').prop("disabled",!1)}),"json")}else log.debug("No targets ")},typechangesubmit:function(){var url,that=$(this);confirm(customlabel.strs[0])&&(customlabel.context.updatelabelid?(url=cfg.wwwroot+"/mod/customlabel/mod.php?",url+="update="+customlabel.context.updatelabelid,url+="&sesskey="+cfg.sesskey,url+="&sr="+customlabel.context.section,url+="&returntomod="+customlabel.context.returntomod,url+="&type="+that.val()):(url=cfg.wwwroot+"/course/mod.php?",url+="id="+customlabel.context.courseid,url+="&section="+customlabel.context.section,url+="&sesskey="+cfg.sesskey,url+="&add=customlabel",url+="&returntomod="+customlabel.context.returntomod,url+="&type="+that.val()),document.location.href=url)}};return customlabel}));

//# sourceMappingURL=customlabel.min.js.map